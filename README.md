# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ DAGs
## –ó–∞–¥–∞–Ω–∏–µ:
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–≥–∏, –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—è –ø–∞–ø–∫—É —Å –∏—Å—Ö–æ–¥–Ω–∏–∫–∞–º–∏. </br>
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ - –æ–¥–∏–Ω –¥–∞–≥. </br>
### –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è:
1. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω. </br>
2. –ü—Ä–æ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–æ–¥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–æ–∫–µ—Ä–∞ –¥–ª—è –∑–∞–¥–∞–Ω–∏—è. –ù–µ —Å—Ç–æ–∏—Ç –¥–µ–ª–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ. </br>
3. –î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞ **DAG** - –¥–µ–Ω—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∫—Ä–∏–ø—Ç–∞. –í—Ä–µ–º—è –∏ —á–∞—Å—Ç–æ—Ç–∞ –∑–∞–ø—É—Å–∫–∞, –¥–æ–ª–∂–Ω—ã –∑–∞–¥–∞–≤–∞—Ç—å—Å—è –≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–µ! –ù–∞–∑–≤–∞–Ω–∏–µ –ª—é–±–æ–µ... </br>
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Ç–∞—Å–∫–∏, —á–µ–º –±–æ–ª—å—à–µ, —Ç–µ–º –ª—É—á—à–µ. –ù–µ—Å–∫–æ–ª—å–∫–æ **Python** —Ñ—É–Ω–∫—Ü–∏–π - –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞—Å–æ–∫ (–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º **def**). –ï—Å—Ç—å —Å–ø–∏—Å–æ–∫ **DDL** –∫–æ–º–∞–Ω–¥ - —Ä–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ —Ç–∞—Å–∫–∏. </br>
5. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –¥–ª—è **Python** —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏ –¥–ª—è **SQL** —Å–∫—Ä–∏–ø—Ç–æ–≤. </br>
6. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ **DAG** –ª–µ–∂–∞—Ç—å –Ω–µ –¥–æ–ª–∂–Ω—ã. </br>

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
### –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
**–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä DAG** - —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è **Airflow DAG** –∏–∑ **Python** –∏ **SQL** —Ñ–∞–π–ª–æ–≤. </br>
–û–Ω –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã, –∏–∑–≤–ª–µ–∫–∞–µ—Ç **Python** —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ **SQL** –∫–æ–º–∞–Ω–¥—ã –∏ —Å–æ–∑–¥–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–µ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é **DAG** —Ñ–∞–π–ª—ã.</br>

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 3 –º–æ–¥—É–ª–µ–π:</br>
- `dag_generator.py` - –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤—Å—é —Ä–∞–±–æ—Ç—É.</br>
- `python_parser.py` - –ø–∞—Ä—Å–∏—Ç **Python** —Ñ–∞–π–ª—ã, –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏.</br>
- `sql_parser.py` - –ø–∞—Ä—Å–∏—Ç **SQL** —Ñ–∞–π–ª—ã, –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã.</br>

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
1. <ins>–û–ø–∏—Å–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π</ins>:
- `/opt/airflow/scripts/`  - –∑–¥–µ—Å—å —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –∏—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã.</br>
- `/opt/airflow/dags/`     - —Å—é–¥–∞ –ø–æ–ø–∞–¥–∞—é—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ **DAG**.</br>
- `/screenshots/` - –ª–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–ø–∫–∞ —Å–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞–º–∏ —Ç–æ–≥–æ, —á—Ç–æ **DAGs** –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–∏ —É—Å–ø–µ—à–Ω–æ.</br>

2. <ins>–ü–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤</ins>:
- –î–ª—è **.py** —Ñ–∞–π–ª–æ–≤ - –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–∏, –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.</br>
- –î–ª—è **.sql** —Ñ–∞–π–ª–æ–≤ - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–æ–º–∞–Ω–¥ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏.</br>

3. <ins>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è **DAG**</ins>:
- –°–æ–∑–¥–∞—é—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ **task_id** –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏.</br>
- –ê–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ **Airflow**.</br>
- –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∞ –æ—à–∏–±–æ–∫.</br>
- –°–æ–∑–¥–∞—é—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏, –µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ.</br>

4. <ins>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ **DAG**</ins>:
- **DAG** —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `/opt/airflow/dags/`</br>
- –ò–º—è —Ñ–∞–π–ª–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º: `generated_<–∏–º—è_–∏—Å—Ö–æ–¥–Ω–æ–≥–æ_—Ñ–∞–π–ª–∞>.py`</br>

### –°–æ–∑–¥–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ 
- –ü—Ä–∏–º–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã –Ω–∏–∂–µ, –µ—Å—Ç—å –≤ –ø–∞–ø–∫–µ `scripts`, –∞ **DAGs** –ø–æ –Ω–∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã –≤ –ø–∞–ø–∫–µ`dags`. </br>
- –°–∫—Ä–∏–Ω—à–æ—Ç—ã —É—Å–ø–µ—à–Ω–æ–π —Ä–∞–±–æ—Ç—ã **DAGs** –¥–ª—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ –ø–∞–ø–∫–∏ `scripts` –ª–µ–∂–∞—Ç –≤ –ø–∞–ø–∫–µ `screenshots`. </br>

<ins>**–ü—Ä–∏–º–µ—Ä—ã –¥–ª—è Python —Ñ–∞–π–ª–æ–≤**</ins>
1. –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä (–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)
```
# DAG: data_pipeline
# schedule: @daily
# owner: data_team
# tags: [etl, data]
# description: Daily data processing pipeline

def extract_data():
    """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞"""
    print("Extracting data from source")

def transform_data():
    """–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö"""
    print("Transforming data")

def load_data():
    """–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ"""
    print("Loading data to warehouse")
```
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 3 –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤ **DAG**

2. –ï—Å–ª–∏ –≤ —Ñ–∞–π–ª–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–ª–æ–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, —Ç–æ–≥–¥–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞
```
# DAG: complex_pipeline
# schedule: @once

def main_pipeline(**kwargs):
    """
    –ì–ª–∞–≤–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    """
    # –§—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç –¥—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
    data = extract()
    processed = transform(data)
    load(processed)

def extract():
    return "raw_data"

def transform(data):
    return f"processed_{data}"

def load(data):
    print(f"Loaded: {data}")
```
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 1 –∑–∞–¥–∞—á–∞ (—Ç.–∫. —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–∑—ã–≤–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞)

<ins>**–ü—Ä–∏–º–µ—Ä—ã –¥–ª—è SQL —Ñ–∞–π–ª–æ–≤**</ins>
1. –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä
```
-- DAG: setup_database_simple
-- schedule: @once
-- owner: dba
-- tags: [setup, database]
-- description: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
DROP TABLE IF EXISTS users_main;
CREATE TABLE IF NOT EXISTS users_main (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

DROP TABLE IF EXISTS orders_main;
CREATE TABLE IF NOT EXISTS orders_main (
    id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(id),
    amount DECIMAL(10,2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
CREATE INDEX idx_orders_main_user_id ON orders_main(user_id);
CREATE INDEX idx_orders_main_created_at ON orders_main(created_at);

-- –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
INSERT INTO users_main (username) VALUES ('admin'), ('user1');
```
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 7 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á (–ø–æ –æ–¥–Ω–æ–π –Ω–∞ –∫–∞–∂–¥—É—é **SQL** –∫–æ–º–∞–Ω–¥—É)

2. –°–ª–æ–∂–Ω—ã–π **SQL** —Å **CTE**
```
-- DAG: daily_sales_report
-- schedule: 0 1 * * *
-- owner: analytics
-- tags: [reporting, analytics, sales]
-- description: –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º
-- retries: 2
-- retry_delay: 300

-- –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –∑–∞–∫–∞–∑–æ–≤ (orders)
DROP TABLE IF EXISTS orders_info;
CREATE TABLE IF NOT EXISTS orders_info (
    id SERIAL PRIMARY KEY,
    user_id INT NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    status VARCHAR(20) DEFAULT 'completed',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ (daily_reports)
DROP TABLE IF EXISTS daily_reports;
CREATE TABLE IF NOT EXISTS daily_reports (
    id SERIAL PRIMARY KEY,
    report_date DATE NOT NULL UNIQUE,
    total_orders INT NOT NULL,
    total_revenue DECIMAL(12,2) NOT NULL,
    average_order_value DECIMAL(10,2),
    generated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –í—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –¥–Ω—è
-- –í—á–µ—Ä–∞—à–Ω–∏–µ –∑–∞–∫–∞–∑—ã (–¥–ª—è –æ—Ç—á–µ—Ç–∞)
INSERT INTO orders_info (user_id, amount, created_at) VALUES
(1, 100.50, CURRENT_DATE - INTERVAL '1 day' + INTERVAL '10:30'),
(2, 75.25, CURRENT_DATE - INTERVAL '1 day' + INTERVAL '14:15'),
(3, 200.00, CURRENT_DATE - INTERVAL '1 day' + INTERVAL '16:45'),
(1, 50.00, CURRENT_DATE - INTERVAL '1 day' + INTERVAL '20:10'),
(4, 300.75, CURRENT_DATE - INTERVAL '1 day' + INTERVAL '22:30');

-- –ü–æ–∑–∞–≤—á–µ—Ä–∞—à–Ω–∏–µ –∑–∞–∫–∞–∑—ã (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ where —É—Å–ª–æ–≤–∏—è)
INSERT INTO orders_info (user_id, amount, created_at) VALUES
(5, 125.00, CURRENT_DATE - INTERVAL '2 days' + INTERVAL '09:00'),
(2, 80.50, CURRENT_DATE - INTERVAL '2 days' + INTERVAL '15:20');

-- –°–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ –∑–∞–∫–∞–∑—ã (–±—É–¥—É—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ—Ç—á–µ—Ç–µ)
INSERT INTO orders_info (user_id, amount, created_at) VALUES
(3, 150.00, CURRENT_DATE + INTERVAL '8 hours'),
(6, 95.30, CURRENT_DATE + INTERVAL '12 hours');

-- –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –¥–∞—Ç–µ
CREATE INDEX IF NOT EXISTS idx_orders_info_created_at ON orders_info(created_at);
CREATE INDEX IF NOT EXISTS idx_orders_info_user_created ON orders_info(user_id, created_at);

-- –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
WITH daily_stats AS (
    SELECT
        DATE(created_at) as report_date,
        COUNT(*) as total_orders,
        SUM(amount) as total_revenue
    FROM orders_info
    WHERE created_at >= CURRENT_DATE - INTERVAL '1 day'
    GROUP BY DATE(created_at)
)
INSERT INTO daily_reports (report_date, total_orders, total_revenue)
SELECT
    report_date,
    total_orders,
    total_revenue
FROM daily_stats
ON CONFLICT (report_date)
DO UPDATE SET
    total_orders = EXCLUDED.total_orders,
    total_revenue = EXCLUDED.total_revenue,
    generated_at = CURRENT_TIMESTAMP;

-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞
UPDATE daily_reports
SET average_order_value = total_revenue / NULLIF(total_orders, 0)
WHERE report_date = CURRENT_DATE - INTERVAL '1 day';
```
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 11 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á (–ø–æ –æ–¥–Ω–æ–π –Ω–∞ –∫–∞–∂–¥—É—é **SQL** –∫–æ–º–∞–Ω–¥—É)

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã DAG –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
1. <ins>–û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è `.py` –∏ `.sql`)</ins>
```
# DAG: my_dag_name           # –ò–º—è DAG, –µ—Å–ª–∏ –Ω–µ—Ç, –≤–æ–∑—å–º–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º generated_ 
# schedule: @daily           # –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
# schedule_interval: 0 2 * * *  # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ schedule (–º–∏–Ω—É—Ç—ã, —á–∞—Å—ã, –¥–µ–Ω—å –º–µ—Å—è—Ü–∞, –º–µ—Å—è—Ü, –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏)
# owner: data_team           # –í–ª–∞–¥–µ–ª–µ—Ü
# tags: [etl, data]          # –¢–µ–≥–∏ (—Å–ø–∏—Å–æ–∫)
# description: –ú–æ–π DAG       # –û–ø–∏—Å–∞–Ω–∏–µ
# catchup: false             # –û—Ç–∫–ª—é—á–∏—Ç—å catchup
# retries: 3                 # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
# retry_delay: 300           # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è–º–∏ (—Å–µ–∫)
# start_date: 2024-01-01     # –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞, –µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –≤–æ–∑—å–º–µ—Ç —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
# max_active_runs: 1         # –ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤
```
2. <ins>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–æ–ª—å–∫–æ –¥–ª—è **SQL** —Ñ–∞–π–ª–æ–≤</ins>
```
-- –î–ª—è SQL —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–≤–æ–π–Ω–æ–π –¥–µ—Ñ–∏—Å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
-- DAG: sql_pipeline
-- schedule: @hourly
-- owner: dba
```
### –ü—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è
1. <ins>–î–ª—è Python —Ñ—É–Ω–∫—Ü–∏–π:</ins></br>
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –∏–º–µ–Ω–∞: _extract_data_, _transform_records_.</br>
- –ò–∑–±–µ–≥–∞–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤.</br>
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ _docstring_.</br>

2. <ins>–î–ª—è SQL –∫–æ–º–∞–Ω–¥:</ins></br>
- –ö–∞–∂–¥–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è `;`. </br>
- –ö–æ–º–∞–Ω–¥—ã –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å—Ç—Ä–æ–∫–∞—Ö –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞. </br>
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –±–ª–æ–∫–æ–≤. </br>

### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è Python —Ñ–∞–π–ª–æ–≤
1. <ins>–ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏:</ins> </br>
- –ö–æ–≥–¥–∞ –≤ —Ñ–∞–π–ª–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é —Ç–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. </br>
- –ù–µ—Ç –≤—ã–∑–æ–≤–æ–≤ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ç–æ–º –∂–µ —Ñ–∞–π–ª–µ. </br>
- –ë–æ–ª–µ–µ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ñ–∞–π–ª–µ.</br>
   
2. <ins>–ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞:</ins> </br>
- –ö–æ–≥–¥–∞ –≤ —Ñ–∞–π–ª–µ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è. </br>
- –§—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã. </br>
- –§—É–Ω–∫—Ü–∏–∏ –≤—ã–∑—ã–≤–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞. </br>
- –ù–∞–π–¥–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å _pipeline_ –≤ –∏–º–µ–Ω–∏. </br>

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è SQL —Ñ–∞–π–ª–æ–≤
1. <ins>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —Ç–∏–ø—ã –∫–æ–º–∞–Ω–¥:</ins> </br>
- `CREATE TABLE, DROP TABLE` </br>
- `CREATE INDEX, DROP INDEX` </br>
- `INSERT, UPDATE, DELETE` </br>
- `SELECT, WITH (CTE)` </br>

2. <ins>–ü–æ–¥ –Ω–∏—Ö —Å–æ–∑–¥–∞—é—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –∑–∞–¥–∞—á:</ins> </br>
- `create_table_users_1`</br> 
- `insert_into_orders_2`</br>
- `create_index_idx_users_email_3`</br>

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
–í—Å–µ **SQL** –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ.</br>
–ü–æ—Ä—è–¥–æ–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–æ—Ä—è–¥–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ.</br>

### –ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
1. `git clone git@github.com:MikhalevaAnna/DE_Airflow_project.git`
2. `cd DE_Airflow_project`
3. `docker-compose up -d`
4. –°–æ–∑–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ **Airflow** —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ </br>
   (–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–ø–∏—Å–∞–Ω—ã –≤ —Ñ–∞–π–ª–µ `docker-compose.yml`):
```
Connection Id:    postgres_default
Connection Type:  Postgres
Host:             pg_extra
Schema:           postgres
Login:            extradb_user
Port:             5432
```
5. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –∏–º–µ–Ω–µ–º `postgres_default`.
6. –ü–æ—Å–ª–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ—á–∏—â–∞–µ–º –ø–∞–ø–∫—É **dags**.
7. –ó–∞–ø—É—Å–∫–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ `Airflow`:</br>
`docker exec -it airflow-scheduler python /opt/airflow/generators/dag_generator.py`.


### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è 
1. –ü—Ä–∏–º–µ—Ä—ã **Python** –∏ **SQl** —Å–∫—Ä–∏–ø—Ç–æ–≤, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –Ω—É–∂–Ω–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å **Airflow DAG** –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `scripts`.
2. **Airflow DAG**, —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ —ç—Ç–∏–º —Å–∫—Ä–∏–ø—Ç–∞–º, —Å –ø–æ–º–æ—â—å—é –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞, –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `dags`.
   
### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
1. <ins>–ß—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –¥–ª—è SQL</ins>:
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ **SQL** –∫–æ–º–∞–Ω–¥—ã.
- –ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è.
- **CTE** (**WITH** –≤—ã—Ä–∞–∂–µ–Ω–∏—è).
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ `--` –∏ `/* */`.
  
2. <ins>–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è</ins>:
- –•—Ä–∞–Ω–∏–º—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã.
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π **SQL** —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏.
- –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –¥–∏–∞–ª–µ–∫—Ç—ã **SQL**.

### –û—Ç–ª–∞–¥–∫–∞
1. <ins>–ï—Å–ª–∏ **DAG** –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è</ins>:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞.
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ —Ñ–∞–π–ª–∞.
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–π/**SQL** –∫–æ–º–∞–Ω–¥.
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –¥–ª—è **Python** (#) –∏ **SQl** (--) —Ñ–∞–π–ª–æ–≤.

2. <ins>–ï—Å–ª–∏ –∑–∞–¥–∞—á–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è</ins>:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ **Airflow**.
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –Ω–∞–ª–∏—á–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π.
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.

### üíª –ü—Ä–æ–µ–∫—Ç –≤—ã–ø–æ–ª–Ω–∏–ª–∏:
- –ú–∏—Ö–∞–ª–µ–≤–∞ –ê–Ω–Ω–∞ –ì–µ–Ω–Ω–∞–¥—å–µ–≤–Ω–∞
- –ú—É—Ö–∞–º–µ–¥–∂–∞–Ω–æ–≤ –ï–≤–≥–µ–Ω–∏–π –ú–∏—Ö–∞–π–ª–æ–≤–∏—á
